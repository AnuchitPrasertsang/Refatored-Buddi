# Copies the web file to a .tgz for upload
#
############################

DEST=/Users/wyatt/Desktop/
WWWDIR="$DEST/www"
HELPDIR="Help"
INCLUDE="$HELPDIR/inc"


#Export the SVN source
rm -rf $WWWDIR
svn export www $WWWDIR

rm -rf $HELPDIR/*
cp -r $WWWDIR/* $HELPDIR

#Replace internal occurrences (in the header) of .php with .html
sed -i .bak  -e 's/.php/.html/' $INCLUDE/header.php

for X in `ls $HELPDIR/*.php`;
	do
	#Replace internal occurrences of .php with .html
	sed -i .bak  -e 's/.php/.html/' $X

	#Rename files to be .html, and add header / footer to them.
	XNEW=`echo $X | cut -f 1 -d .`
	cat $INCLUDE/header.php > $XNEW.html
	cat $X | grep -v '<? include ' >> $XNEW.html
	cat $INCLUDE/footer.php | grep -v 'http://sourceforge.net' >> $XNEW.html
	done

rm -f $HELPDIR/*.php
rm -f $HELPDIR/*.bak
rm -rf $HELPDIR/inc

if [ "$1" != "--local" ]; then
	#Tar the pages
	cd $WWWDIR
	tar -czvf $WWWDIR.tgz *

	#Send the tar and untar it
	scp $WWWDIR.tgz olsonw@shell.sf.net:/home/groups/b/bu/buddi/htdocs
	ssh olsonw@shell.sf.net 'tar -C /home/groups/b/bu/buddi/htdocs -zxvf /home/groups/b/bu/buddi/htdocs/www.tgz'
	
	#Remove Tar file
	rm $WWWDIRwww.tgz
fi

rm -rf $WWWDIR