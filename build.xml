<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="fatjar" name="Buddi">
	<property environment="env"/>
	
<!--
	<property name="BUDDI_HOME" value="/Users/wyatt/Documents/Programming/Workplace/Buddi"/>
	<property name="FATJAR_PATH" value="/Applications/Eclipse/plugins/net.sf.fjep.fatjar_0.1.0/fatjar.jar"/>
-->

	<property name="BUDDI_HOME"  value="${env.BUDDI_HOME}"/>
	<property name="FATJAR_PATH"  value="${env.FATJAR_PATH}"/>

	<target name="checkProperties" description="Internal target - used to verify properties point at valid files">
		<available file="${BUDDI_HOME}" type="dir" property="BUDDI_HOME.exists"/>
		<available file="${FATJAR_PATH}" type="file" property="FATJAR_PATH.exists"/>
	</target>  

	<target name="no.BUDDI_HOME" unless="BUDDI_HOME.exists" description="internal">
		<fail>"BUDDI_HOME" must be defined and point to a valid directory.</fail>
	</target>  

	<target name="no.FATJAR_PATH" unless="FATJAR_PATH.exists" description="internal">
		<fail>"FATJAR_PATH" must be defined and point to a valid jar file.</fail>
	</target>  

	<target name="checkForRequiredProperies"  description="Internal target - used to verify configuration" depends="checkProperties,no.BUDDI_HOME,no.FATJAR_PATH">
	</target>  

	<target name="init"  description="Internal target - used to set up all targets" depends="checkForRequiredProperies">
	</target>  

	<!-- Define the classpath for this build.  Needed for the jarring. -->
	<path id="Buddi.classpath">
		<pathelement location="bin"/>
		<pathelement location="lib/jfreechart-1.0.1.jar"/>
		<pathelement location="lib/jcommon-1.0.5.jar"/>
		<pathelement location="lib/quaqua-3.6.11.jar"/>
		<pathelement location="lib/jcalendar-1.3.2.jar"/>
		<pathelement location="lib/emf/emf.ecore_2.2.2.v200702010000.jar"/>
		<pathelement location="lib/emf/emf.ecore.xmi_2.2.2.v200702010000.jar"/>
		<pathelement location="lib/emf/emf.common_2.2.1.v200702010000.jar"/>
		<pathelement location="lib/BrowserLauncher2-10.jar"/>
		<pathelement location="lib/MRJAdapter-1.0.9.jar"/>
		<pathelement location="lib/truefilter-1.2.jar"/>
		<pathelement location="lib/moss-0.6.1.0.jar"/>
		<pathelement location="lib/swingx-2006_10_27.jar"/>
	</path> 

	<!-- Define the tasks and associated classes for FatJar -->
	<target depends="init,jar" name="fatjar" description="Create Fat Jar">
		<taskdef name="fatjar.build" classname="net.sf.fjep.anttask.FJBuildTask" classpath="${FATJAR_PATH}" loaderref="${FATJAR_PATH}"/>
		<typedef name="fatjar.manifest" classname="net.sf.fjep.anttask.FJManifestType" classpath="${FATJAR_PATH}" loaderref="${FATJAR_PATH}"/>
		<typedef name="fatjar.exclude" classname="net.sf.fjep.anttask.FJExcludeType" classpath="${FATJAR_PATH}" loaderref="${FATJAR_PATH}"/>
		<typedef name="fatjar.jarsource" classname="net.sf.fjep.anttask.FJJarSourceType" classpath="${FATJAR_PATH}" loaderref="${FATJAR_PATH}"/>
		<typedef name="fatjar.filesource" classname="net.sf.fjep.anttask.FJFileSourceType" classpath="${FATJAR_PATH}" loaderref="${FATJAR_PATH}"/>
		<typedef name="fatjar.autojar" classname="net.sf.fjep.anttask.FJAutoJarType" classpath="${FATJAR_PATH}" loaderref="${FATJAR_PATH}"/>
		<typedef name="fatjar.class" classname="net.sf.fjep.anttask.FJClassType" classpath="${FATJAR_PATH}" loaderref="${FATJAR_PATH}"/>
	
		<fatjar.build output="Buddi.jar">
			<fatjar.manifest mainclass="org.homeunix.drummer.Buddi"/>
			<!-- This is the skinny jar file, just compiled below -->
			<fatjar.jarsource file="${BUDDI_HOME}/Buddi-base.jar" relpath=""/>

			<!-- These are the resource jars, containing images, documents, languages, etc -->
			<fatjar.jarsource file="${BUDDI_HOME}/Buddi-documents.jar" relpath=""/>
			<fatjar.jarsource file="${BUDDI_HOME}/Buddi-languages.jar" relpath=""/>
			<fatjar.jarsource file="${BUDDI_HOME}/Buddi-licenses.jar" relpath=""/>
			<fatjar.jarsource file="${BUDDI_HOME}/Buddi-resources.jar" relpath=""/>
			
			<!-- These are all the included files which normally would go on the classpath -->
			<fatjar.jarsource file="${BUDDI_HOME}/lib/BrowserLauncher2-10.jar" relpath=""/> 
			<fatjar.jarsource file="${BUDDI_HOME}/lib/MRJAdapter-1.0.9.jar" relpath=""/>
			<fatjar.jarsource file="${BUDDI_HOME}/lib/emf/emf.ecore_2.2.2.v200702010000.jar" relpath=""/>
			<fatjar.jarsource file="${BUDDI_HOME}/lib/emf/emf.ecore.xmi_2.2.2.v200702010000.jar" relpath=""/>
			<fatjar.jarsource file="${BUDDI_HOME}/lib/emf/emf.common_2.2.1.v200702010000.jar" relpath=""/>
			<fatjar.jarsource file="${BUDDI_HOME}/lib/jcalendar-1.3.2.jar" relpath=""/>
			<fatjar.jarsource file="${BUDDI_HOME}/lib/jcommon-1.0.5.jar" relpath=""/>
			<fatjar.jarsource file="${BUDDI_HOME}/lib/jfreechart-1.0.1.jar" relpath=""/>
			<fatjar.jarsource file="${BUDDI_HOME}/lib/moss-0.6.0.jar" relpath=""/>
			<fatjar.jarsource file="${BUDDI_HOME}/lib/swingx-2006_10_27.jar" relpath=""/>
			<fatjar.jarsource file="${BUDDI_HOME}/lib/truefilter-1.2.jar" relpath=""/>
		</fatjar.build>
	</target>

	<target name="compile" description="Compile Buddi">
		<javac srcdir="src" destdir="bin" classpath=""/>
	</target>

	<target name="clean" description="Delete component .Jars">
		<delete>
			<fileset dir=".">
				<include name="*.jar"/>
			</fileset>
		</delete>
	</target>
	
	<target name="jar" depends="clean,compile" description="Create component .Jars">
		<jar destfile="Buddi-plugin-api.jar" basedir="bin">
		   <fileset dir="bin">
			 <include name="net/sourceforge/buddi/api/**"/>
			 <include name="org/homeunix/drummer/plugins/interfaces/BuddiPluginGeneric.class"/>
		   </fileset>
			<manifest>
               <attribute name="Built-By" value="${user.name}"/>
               <section name="BuddiPluginAPI">
                   <attribute name="Title" value="BuddiPluginAPI"/>
                   <attribute name="Version" value="2.3.9"/>
                   <attribute name="Vendor" value="https://sourceforge.net/projects/buddi-plugins/"/>
               </section>
           </manifest>
		</jar>
		<jar destfile="Buddi-base.jar" basedir="bin" includes="**/*.class" />
		<jar destfile="Buddi-languages.jar" basedir="Languages" includes="**/*.lang" />
		<jar destfile="Buddi-documents.jar" basedir="Documents" includes="**/*.txt" />
		<jar destfile="Buddi-licenses.jar" basedir="Licenses" includes="**/*.txt" />
		<jar destfile="Buddi-resources.jar" basedir="Resources" includes="**/*" />
	</target>
</project>
